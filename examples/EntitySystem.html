<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Creatine Example: Entity-Component-System</title>

    <script src="../_assets/libs/easeljs-NEXT.combined.js"></script>
    <script src="../_assets/libs/tweenjs-NEXT.combined.js"></script>
    <script src="../_assets/libs/preloadjs-NEXT.combined.js"></script>

    <script src="../src/creatine.js"></script>
    <script src="../src/helpers/functions.js"></script>
    <script src="../src/ecs/Entity.js"></script>
    <script src="../src/ecs/Component.js"></script>
    <script src="../src/ecs/System.js"></script>
    
    <script src="../_assets/js/base.js"></script>
    <link href="../_assets/css/base.css" rel="stylesheet">
</head>

<body onLoad="init();">
    <canvas id="canvas" width="640" height="480">JavaScript Not Enabled.</canvas>
</body>
</html>

<script type="text/javascript">
    var canvas    = null;
    var stage     = null;
    var boxEntity = null;
    var system    = null;

    var VisualComponent = function(image) { this.image = image; }
    VisualComponent.prototype       = new creatine.Component();
    VisualComponent.prototype.name  = 'visual';
    VisualComponent.prototype.image = null;

    var ScaleComponent = function() {};
    ScaleComponent.prototype           = new creatine.Component();
    ScaleComponent.prototype.name      = 'scale';
    ScaleComponent.prototype.direction = 1;

    var ScaleSystem = function() {};
    ScaleSystem.prototype         = new creatine.System();
    ScaleSystem.prototype.process = function(entities) {
        for (var i=0; i<entities.length; i++) {
            var entity = entities[i];

            var scale = entity.getComponent('scale');
            var visual = entity.getComponent('visual');

            var factor = visual.image.scaleX;

            factor += scale.direction*createjs.Ticker.getInterval()/100;

            if (factor < 0.1 || factor > 5) {
                scale.direction *= -1;        
                factor = creatine.clip(factor, 0.1, 5);
            }

            visual.image.scaleX = factor;
            visual.image.scaleY = factor;
        }
    }

    function init() {
        canvas = document.getElementById('canvas');
        stage = new createjs.Stage(canvas);

        var square = new createjs.Shape();
        square.graphics.beginFill('red');
        square.graphics.drawRect(-50, -50, 100, 100);
        square.x = 320;
        square.y = 240;
        stage.addChild(square);

        boxEntity = new creatine.Entity();
        boxEntity.addComponent(new VisualComponent(square));
        boxEntity.addComponent(new ScaleComponent());

        system = new ScaleSystem()

        createjs.Ticker.addEventListener('tick', onTick);
    }

    function onTick(event) {
        system.process([boxEntity]);
        stage.update();
    }
</script>